<nz-card id="chat-card">
	<div id="chat-content" #chatContent>
		<ng-container *ngIf="messageFeed$ | async as feed">
			<ng-container *ngIf="(roomHasMultipleMembers$ | async) === true; else memberAloneTpl">
				<ng-container *ngIf="feed.length; else noMessageTpl">
					<div class="top-reached" [class.hidden-opacity]="feed.length < 10">
						Vous avez atteint la limite de l'historique 🔭
					</div>
					<mas-message-group
						*ngFor="let entry of feed; trackBy: trackByFeedEntryFn"
						[group]="entry"
					></mas-message-group>
				</ng-container>
				<ng-template #noMessageTpl>
					<div class="p2">
						<nz-empty
							nzNotFoundContent="Le premier message n'attend que vous 🤗"
						></nz-empty>
					</div>
				</ng-template>
			</ng-container>
			<ng-template #memberAloneTpl>
				<div class="p2">
					<nz-empty
						nzNotFoundContent="On se sent un peu seul ici, non ? 🙁"
						nzNotFoundImage="simple"
						[nzNotFoundFooter]="invitationsTpl"
					></nz-empty>
					<ng-template #invitationsTpl>INVITATIONS</ng-template>
				</div>
			</ng-template>
		</ng-container>
	</div>
	<div style="position: relative">
		<div
			fxLayoutAlign="center center"
			class="new-message-badge-container"
			*ngIf="showNewMessageTag$ | async"
		>
			<nz-tag [nzColor]="'#f50'" (click)="scrollToBottomOfChat()"> nouveaux messages </nz-tag>
		</div>
		<nz-badge
			*ngIf="stickToChatBottom$ | async as stickToChatBottom"
			nzStatus="processing"
			id="stick-chat"
			[nz-tooltip]="
				stickToChatBottom ? 'Les derniers messages s\'affichent à la suite' : undefined
			"
			nzTooltipColor="blue"
		></nz-badge>
		<form id="message-form" [formGroup]="newMessageForm" (ngSubmit)="sendMessage()">
			<div fxLayout="row" fxLayoutAlign="center flex-end">
				<textarea
					#newMessageInput
					nz-input
					nzSize="large"
					type="text"
					placeholder="Message"
					formControlName="message"
					nzAutosize
					(keydown.enter)="$event.preventDefault(); sendMessage()"
				></textarea>
				<button
					type="submit"
					nz-button
					nzSize="large"
					nzType="primary"
					id="send-button"
					[disabled]="(roomHasMultipleMembers$ | async) === false"
				>
					<i nz-icon nzType="send" nzTheme="outline"></i>
					Envoyer
				</button>
			</div>
		</form>
	</div>
</nz-card>
